@using EnjOffer.Core.DTO;
@model IEnumerable<UserStatisticsResponse>;
@{
    ViewBag.Title = "Personal cabinet";
}

@*<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/admin-panel.css">
    <title>Document</title>
</head>*@

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="~/admin-panel.css">
    <title>@ViewBag.Title</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
@{
    string js = @"function formInteraction() {
        const button = document.querySelector('.form-button');
        if (button.innerHTML === 'Open form') {
            button.innerHTML = 'Close form';
        } else {
            button.innerHTML = 'Open form';
        }
    }

    function canDelete() {
        const checkAccount = document.getElementById('check-for-delete-account');
        const checkWord = document.getElementById('check-for-delete-word');
        const removeAccount = document.getElementById('remove-account-button');
        const removeWord = document.getElementById('remove-word-button');

        removeAccount && checkAccount.checked
            ? (removeAccount.disabled = false)
            : (removeAccount.disabled = true)

        removeWord && checkWord.checked
            ? (removeWord.disabled = false)
            : (removeWord.disabled = true)
    }";
}
<script>
    @Html.Raw(js);
</script>
</head>
<body>
    <main class="admin-panel">
    <a href="/">Personal cabinet</a>
        <a href="word-trainer">Word trainer</a>
        <a href="library">Library</a>
        <a href="book-reader">Book reader</a>
    @*Html.PartialAsync("_Header")*@
    <div class="admin-panel__main">
        <h2 class="admin-panel__sections">
            Admin panel. Welcome, @User.Identity?.Name!
        </h2>

            <div class="manager">

                    <form id="create-admin-account" method="POST" action="personal-cabinet/add-admin">
                    <h3>Add admin account</h3>
                    <details>
                        <summary class="form-button" onclick="formInteraction()">Open form</summary>
                        <div class="input-field">
                        <div class="input-field__item">
                            <p>Email</p>
                            <input type="email" class="input-field__input" name="Email" required/>
                        </div>
                        <div class="input-field__item">
                            <p>Password</p>
                            <input type="password" class="input-field__input" name="Password" minlength="6" required/>
                        </div>
                        <div class="input-field__item">
                            <p>Confirm password</p>
                            <input type="password" class="input-field__input" name="RepeatedPassword" minlength="6" required/>
                        </div>
                        <div class="input-field__item">
                            @*<p>Role</p>
                            <input type="text" class="input-field__input" name="Role" required/>*@
                            <label>Admin</label>
                            <input type="radio" name="UserType" value="Admin" checked/>
                            @*<select name="UserType">
                                <option checked value="Admin">Admin</option>
                                <option value="User">User</option>
                            </select>*@
                        </div>
                            @if (ViewBag.ErrorsRegister is not null)
                            {
                                foreach(var item in ViewBag.ErrorsRegister)
                                {
                                    <span style="color: red; font-style: italic;">@item</span>
                                }
                            }
                        <button class="input-field__button">Create account</button>
                    </div>
                </details>
            </form>
            <form id="remove-admin-account" method="POST" action="personal-cabinet/delete-admin">
                <h3>Remove admin account</h3>
                <details>
                    <summary class="form-button" onclick="formInteraction()">Open form</summary>
                    <div class="input-field">
                        <div class="input-field__item">
                            <p>Email</p>
                            <input type="email" class="input-field__input" name="Email" required/>
                        </div>
                       @if (ViewBag.ErrorsDeleteAdmin is not null)
                            {
                                foreach(var item in ViewBag.ErrorsDeleteAdmin)
                                {
                                    <span style="color: red; font-style: italic;">@item</span>
                                }
                            }
                        <div class="remove-section">
                            <div class="remove-section__check">
                                <p class="warning-text">I am sure</p>
                                <input type="checkbox" id="check-for-delete-account" onclick="canDelete()">
                            </div>
                            <button type="submit" id="remove-account-button" class="input-field__button" disabled>Remove
                                account</button>
                                </div>
                            </div>
                        </details>
                    </form>
            <form id="database-add-word" method="POST" action="/personal-cabinet/add-default-word">
                <h3>Add word to database</h3>
                <details>
                    <summary class="form-button" onclick="formInteraction()">Open form</summary>
                    <div class="input-field">
                        <div class="input-field__item">
                            <p>Word</p>
                            <input type="text" class="input-field__input" name="Word" required />
                        </div>
                        <div class="input-field__item">
                            <p>Translation</p>
                            <input type="text" class="input-field__input" name="WordTranslation" required />
                        </div>
                        <div class="input-field__item">
                            <p>Link to image</p>
                            <input type="text" class="input-field__input" name="ImageSrc" />
                        </div>
                        @if (ViewBag.ErrorsAddDefaultWord is not null)
                            {
                                foreach(var item in ViewBag.ErrorsAddDefaultWord)
                                {
                                    <span style="color: red; font-style: italic;">@item</span>
                                }
                            }
                        <button type="submit" class="input-field__button">Add new word</button>
                    </div>
                </details>
            </form>
            <form id="database-remove-word" method="POST" action="/personal-cabinet/delete-default-word">
                <h3>Remove word from database</h3>
                <details>
                    <summary class="form-button" onclick="formInteraction()">Open form</summary>
                    <div class="input-field">
                        <div class="input-field__item">
                            <p>Word</p>
                            <input type="text" class="input-field__input" name="Word" required/>
                        </div>
                        <div class="input-field__item">
                            <p>Word Translation</p>
                            <input type="text" class="input-field__input" name="WordTranslation" required/>
                        </div>
                        @if (ViewBag.ErrorsDeleteDefaultWord is not null)
                            {
                                foreach(var item in ViewBag.ErrorsDeleteDefaultWord)
                                {
                                    <span style="color: red; font-style: italic;">@item</span>
                                }
                            }
                        <div class="remove-section">
                            <div class="remove-section__check">
                                <p class="warning-text">I am sure</p>
                                <input type="checkbox" id="check-for-delete-word" onclick="canDelete()">
                            </div>
                            <button type="submit" id="remove-word-button" class="input-field__button" disabled>Remove
                                word</button>
                        </div>
                    </div>
                </details>
            </form>
        </div>
        <h2 class="admin-panel__sections" style="margin-bottom: 0;">Statistics</h2>
        <div>
            <canvas id="myChart" class="myChart"></canvas>
        </div>
        <a href="logout" class="input-field__button">Log out</a>
            <div class="advices">
                @foreach(AdviceResponse item in ViewBag.Advice)
                {
                    <div class="advice">
                        <h4>Advice #@item.AdviceNumber</h4>
                        <p>@item.AdviceContent</p>
                    </div>
                }
        </div>
    </div>
</main>
@{
    string?[] dates = Model.Select(temp => temp.AnswerDate!.Value.Date.ToShortDateString()).ToArray();
    int[] correctWordsPerDay = Model.Select(temp => temp.CorrectAnswersCount).ToArray();
    int[] incorrectWordsPerDay = Model.Select(temp => temp.IncorrectAnswersCount).ToArray();

    string jsDates = string.Join(",", dates.Select(d => "'" + DateTime.Parse(d).ToString("MM/dd/yyyy") + "'"));
    string jsCorrectWordsPerDay = string.Join(",", correctWordsPerDay);
    string jsIncorrectWordsPerDay = string.Join(",", incorrectWordsPerDay);

    string diagramJs = $@"var data = {{
            labels: [{jsDates}],
            datasets: [
                {{
                    label: 'Правильно введені слова',
                    backgroundColor: 'green',
                    data: [{jsCorrectWordsPerDay}]
                }},
                {{
                    label: 'Неправильно введені слова',
                    backgroundColor: 'red',
                    data: [{jsIncorrectWordsPerDay}]
                }}
            ]
        }};

        var options = {{
            scales: {{
                yAxes: [{{
                    ticks: {{
                        beginAtZero: true
                    }}
                }}],
            }}
        }};

        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, {{
            type: 'bar',
            data: data,
            options: options
        }});";
}
<script>
    @Html.Raw(diagramJs);
</script>
</body>

</html>




